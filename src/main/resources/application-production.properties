# --- SERVER CONFIG ---
server.port=${PORT:8080}
# üëá D√íNG C·ª®U TINH: Gi√∫p OAuth2 nh·∫≠n di·ªán ƒë√∫ng HTTPS tr√™n Railway/Render
server.forward-headers-strategy=native

# --- SESSION COOKIE (CROSS-SITE) ---
# ƒê·ªÉ FE (localhost) g·ªçi BE (Railway/Render) c√≥ g·ª≠i JSESSIONID trong fetch/axios:
# B·∫Øt bu·ªôc SameSite=None v√† Secure=true.
server.servlet.session.cookie.same-site=none
server.servlet.session.cookie.secure=true
server.servlet.session.cookie.http-only=true
server.servlet.session.cookie.path=/

# --- MULTIPART UPLOAD (Railway/Production) ---
# Tr√°nh l·ªói "Failed to parse multipart servlet request" / FileCountLimitExceededException
spring.servlet.multipart.max-file-size=20MB
spring.servlet.multipart.max-request-size=20MB
# Tomcat 11: gi·ªõi h·∫°n s·ªë l∆∞·ª£ng part (fields + files) trong multipart
server.tomcat.max-part-count=200

# --- DATABASE (Aiven MySQL) ---
# Th√™m ?ssl-mode=REQUIRED ƒë·ªÉ b·∫£o m·∫≠t k·∫øt n·ªëi v·ªõi Aiven
spring.datasource.url=jdbc:mysql://${DB_HOST}:${DB_PORT}/${DB_NAME}?ssl-mode=REQUIRED
spring.datasource.username=${DB_USER}
spring.datasource.password=${DB_PASSWORD}

# --- JPA / HIBERNATE ---
# Production: DB schema ƒë√£ ·ªïn, ch·ªâ c·∫ßn ch·∫°y v·ªõi ch·∫ø ƒë·ªô none ƒë·ªÉ kh√¥ng t·ª± t·∫°o / kh√¥ng validate qu√° g·∫Øt
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQLDialect
# Fix l·ªói c√∫ ph√°p SQL (ƒë·∫∑c bi·ªát v·ªõi b·∫£ng c√≥ t√™n tr√πng t·ª´ kh√≥a)
spring.jpa.properties.hibernate.globally_quoted_identifiers=true

# --- OAUTH2 COGNITO ---
spring.security.oauth2.client.registration.cognito.client-id=${COGNITO_CLIENT_ID}
spring.security.oauth2.client.registration.cognito.client-secret=${COGNITO_CLIENT_SECRET}
spring.security.oauth2.client.registration.cognito.scope=openid,email,profile
spring.security.oauth2.client.registration.cognito.redirect-uri={baseUrl}/login/oauth2/code/{registrationId}
spring.security.oauth2.client.registration.cognito.authorization-grant-type=authorization_code
spring.security.oauth2.client.provider.cognito.issuer-uri=${COGNITO_ISSUER_URI}
spring.security.oauth2.client.registration.cognito.client-name=Cognito

# --- APPLICATION URLs ---
# Backend URL (t·ª± ƒë·ªông detect t·ª´ Render/Railway, ho·∫∑c set th·ªß c√¥ng)
app.backend.url=${BACKEND_URL:}
app.frontend.url=${FRONTEND_URL:http://localhost:5173}

# --- CORS CONFIG ---
# Cho ph√©p Localhost V√Ä Frontend th·∫≠t (ƒë·∫∑t trong bi·∫øn m√¥i tr∆∞·ªùng FRONTEND_URL)
# V√≠ d·ª• tr√™n Railway set FRONTEND_URL = https://nutrimate-frontend.vercel.app
app.cors.allowed-origins=http://localhost:5173,http://127.0.0.1:5173,${FRONTEND_URL}

# --- LOGGING ---
logging.level.root=INFO
logging.level.com.nutrimate=INFO

# --- SWAGGER UI CONFIG ---
# Sort tags theo alphabet trong Swagger UI
springdoc.swagger-ui.tagsSorter=alpha
springdoc.swagger-ui.operationsSorter=alpha